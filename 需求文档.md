# 软件需求规格说明书 (SRS)

**项目名称：** 智能日历应用 (Smart Calendar App)  
**适用平台：** Android (基于 Android 原生 API 开发)  
**文档版本：** V2.0  
**编写日期：** 2025年12月16日  

-----

## 1\. 引言

### 1.1 编写目的

本文档旨在明确"智能日历应用"的功能需求、非功能需求及技术实现规范。作为软件开发和测试的依据，同时满足《大前端技术》课程作业对于移动端日历应用的开发要求。

### 1.2 项目背景

本项目要求基于 Android 原生技术栈开发一款功能完备的日历应用，需支持多视图切换、日程管理及提醒功能，并扩展支持农历显示与 RFC5545 标准的日程导入导出。

### 1.3 技术选型

| 类别 | 技术选择 |
|------|----------|
| **开发工具** | Android Studio |
| **开发语言** | Kotlin |
| **UI 框架** | Jetpack Compose |
| **架构模式** | MVVM (Model-View-ViewModel) |
| **目标平台** | Android |
| **最低 SDK** | API 26 (Android 8.0) |
| **编译 SDK** | API 35 |

### 1.4 关键依赖库

| 依赖库 | 用途 |
|--------|------|
| Jetpack Compose | 声明式 UI 框架 |
| Room | 本地数据库持久化 |
| Navigation Compose | 页面导航 |
| ViewModel + StateFlow | 状态管理 |
| Material 3 | Material Design 3 组件 |
| OkHttp | 网络请求（订阅同步） |
| AlarmManager | 日程提醒调度 |

-----

## 2\. 功能需求 (Functional Requirements)

### 2.1 日历视图模块 (Calendar Views)

系统提供三种维度的视图展示，用户可通过顶部导航进行切换。

#### 2.1.1 月视图 (Month View)

- **基本展示：** 采用 Compose Column + Row 实现 7xN 网格布局（行数根据月份动态计算 4-6 行）
- **周起始日：** 周日为每周第一天
- **信息层级：**
  - 主显示：公历日期（数字）
  - 副显示：农历日期、节气或传统节日（如"初一"、"冬至"）
  - 状态标记：有日程的日期下方显示灰色圆点标记
- **交互逻辑：**
  - 支持左右滑动切换月份
  - 点击日期可高亮选中，下方显示该日详细日程列表
  - 点击日期可快速跳转到日视图
- **非当前月日期：** 显示相邻月份的填充日期，颜色较浅，同样支持日程圆点标记

#### 2.1.2 周视图 (Week View)

- **基本展示：** 横向展示周日至周六，纵向展示 00:00 至 24:00 的时间轴
- **头部信息：** 显示日期、星期、农历信息，当天和选中日期高亮
- **日程渲染：** 根据日程的开始和结束时间在时间轴上渲染色块，色块高度代表持续时长
- **全天日程：** 在顶部单独区域显示全天日程
- **当前时间线：** 在今天的视图中显示红色横线标识当前时间

#### 2.1.3 日视图 (Day View)

- **基本展示：** 详细展示选中日期的完整时间轴（0-24小时）
- **日期信息：** 显示公历日期、星期、完整农历信息（年份、生肖、月份、日期）
- **全天日程区：** 顶部显示当天的全天日程列表
- **时间轴日程：** 在对应时间位置显示日程色块
- **当前时间线：** 今天日视图显示红色当前时间指示线
- **冲突处理：** 同一时间段有多个日程时并排展示

### 2.2 日程管理模块 (Event Management)

支持对日程数据的增、删、改、查（CRUD）操作。

#### 2.2.1 新建日程

- 用户可通过悬浮按钮（FAB）进入新建日程页面
- **必填字段：** 标题、开始时间、结束时间
- **选填字段：** 地点、备注描述、是否全天、日程颜色
- **提醒设置：** 可选择不提醒、事件发生时、提前5/10/15/30分钟、提前1/2小时、提前1天
- **数据验证：** 结束时间不得早于开始时间

#### 2.2.2 编辑与查看

- 在任意视图点击日程条目，进入详情页
- 详情页展示所有字段信息，提供"编辑"和"删除"入口
- 编辑功能复用新建页面逻辑

#### 2.2.3 删除日程

- 支持在详情页点击"删除"按钮
- 删除前需弹窗二次确认

#### 2.2.4 批量删除日程

- **按日期范围删除：** 在设置页面提供按日期范围批量删除日程功能，用户可指定开始日期和结束日期
- **一键删除所有本地日程：** 支持一键删除所有手动创建的日程（不影响订阅来源的日程）
- **安全确认：** 批量删除操作前需弹窗二次确认，提示用户此操作不可恢复

### 2.3 日程提醒模块 (Notifications)

- **提醒设置：** 用户在新建/编辑日程时选择提醒时间
- **提醒选项：** 不提醒、事件发生时、提前5/10/15/30分钟、提前1/2小时、提前1天
- **推送实现：** 使用 AlarmManager 在指定时间触发系统通知
- **开机恢复：** 通过 BootReceiver 在设备重启后恢复所有未来提醒

### 2.4 扩展功能模块 (Extended Features)

#### 2.4.1 农历与节假日

- **农历算法：** 自定义 LunarCalendarUtil 工具类，实现完整的农历计算
- **展示内容：**
  - 农历日期（初一显示月份名）
  - 干支纪年、生肖
  - 二十四节气
  - 传统节日（春节、元宵、端午、中秋、重阳等）
- **节气计算：** 基于天文算法精确计算二十四节气

#### 2.4.2 导入/导出 (RFC5545 支持)

- **导出功能：** 将所有日程（包括本地和订阅）导出为符合 RFC5545 标准的 .ics 文件，支持分享
- **导入功能：** 支持通过文件选择器解析外部 .ics 文件，将日程导入本地数据库
- **格式支持：** 完整支持 VEVENT 组件，包括全天事件、时区处理等

#### 2.4.3 网络订阅 (WebCal/ICS)

- **订阅管理：** 设置页面提供订阅列表管理
- **添加订阅：** 输入名称和 URL（支持 webcal:// 和 https://）
- **同步功能：** 
  - 单个订阅手动同步
  - 一键同步所有订阅
  - 显示上次同步时间
- **删除订阅：** 删除订阅时同时删除相关日程

-----

## 3\. 数据需求 (Data Requirements)

采用 Room 本地数据库进行数据持久化存储。

### 3.1 日程事件实体 (CalendarEvent)

```kotlin
@Entity(tableName = "calendar_events")
data class CalendarEvent(
    @PrimaryKey
    val id: String,              // 唯一标识符 (UUID)
    val title: String,           // 日程标题
    val description: String?,    // 备注描述 (可选)
    val location: String?,       // 地点 (可选)
    val startTime: Long,         // 开始时间戳 (ms)
    val endTime: Long,           // 结束时间戳 (ms)
    val isAllDay: Boolean,       // 是否全天事件
    val reminder: Int?,          // 提醒时间 (分钟)
    val color: String?,          // 日程颜色
    val isFromSubscription: Boolean, // 是否来自订阅
    val subscriptionUrl: String?     // 订阅来源 URL
)
```

### 3.2 订阅实体 (Subscription)

```kotlin
@Entity(tableName = "calendar_subscriptions")
data class Subscription(
    @PrimaryKey
    val id: String,           // 唯一标识符 (UUID)
    val name: String,         // 订阅名称
    val url: String,          // 订阅 URL
    val color: String?,       // 订阅颜色
    val isEnabled: Boolean,   // 是否启用
    val lastSyncTime: Long?,  // 上次同步时间
    val createdAt: Long       // 创建时间
)
```

### 3.3 存储策略

- **数据库：** 使用 Room 持久化库，底层基于 SQLite
- **DAO 接口：** CalendarEventDao 和 SubscriptionDao 提供完整 CRUD 操作
- **Repository 模式：** 采用 Repository 模式封装数据操作
- **响应式数据流：** 使用 Kotlin Flow 实现数据库变化的实时监听

-----

## 4\. 非功能性需求 (Non-Functional Requirements)

### 4.1 性能要求

- **启动速度：** App 冷启动时间不超过 2 秒
- **滑动帧率：** 视图切换和滑动保持 60fps，无明显卡顿
- **数据库响应：** 查询操作响应时间不超过 100ms

### 4.2 兼容性要求

- **系统版本：** 支持 Android 8.0 (API 26) 及以上版本
- **屏幕适配：** 适配主流全面屏手机，正确处理系统栏
- **深色模式：** 支持系统深色模式自动切换

### 4.3 易用性要求

- 界面设计遵循 Material Design 3 设计规范
- 操作流程清晰，核心功能操作步骤不超过 3 步
- 提供清晰的视觉反馈和错误提示

-----

## 5\. 项目结构

```
app/src/main/java/com/example/calendar/
├── CalendarApplication.kt      # Application 类
├── MainActivity.kt             # 主 Activity
├── data/
│   ├── entity/                 # Room Entity 类
│   │   ├── CalendarEvent.kt
│   │   └── Subscription.kt
│   ├── dao/                    # DAO 接口
│   │   ├── CalendarEventDao.kt
│   │   └── SubscriptionDao.kt
│   ├── database/               # Database 类
│   │   └── AppDatabase.kt
│   └── repository/             # Repository 类
│       ├── CalendarRepository.kt
│       └── SubscriptionRepository.kt
├── ui/
│   ├── calendar/               # 日历视图组件
│   │   ├── CalendarScreen.kt
│   │   ├── MonthView.kt
│   │   ├── WeekView.kt
│   │   ├── DayView.kt
│   │   └── DayCell.kt
│   ├── event/                  # 日程相关页面
│   │   ├── EventEditScreen.kt
│   │   └── EventDetailScreen.kt
│   ├── settings/               # 设置页面
│   │   └── SettingsScreen.kt
│   ├── navigation/             # 导航配置
│   │   └── Navigation.kt
│   └── theme/                  # 主题配置
│       ├── Color.kt
│       ├── Theme.kt
│       └── Type.kt
├── viewmodel/                  # ViewModel 类
│   ├── CalendarViewModel.kt
│   ├── EventDetailViewModel.kt
│   └── SettingsViewModel.kt
├── notification/               # 通知提醒
│   ├── NotificationHelper.kt
│   ├── ReminderReceiver.kt
│   └── BootReceiver.kt
├── sync/                       # 订阅同步
│   └── SubscriptionSyncService.kt
└── util/                       # 工具类
    ├── DateUtils.kt
    ├── LunarCalendarUtil.kt
    └── IcsUtils.kt
```

-----

## 6\. 界面设计概览

| 页面 | 主要功能 |
|------|----------|
| 月视图 | 网格展示当月日期、农历、日程标记点，下方显示选中日期日程列表 |
| 周视图 | 7天时间轴，展示日程时间块，支持快速浏览一周安排 |
| 日视图 | 单日详细时间轴，完整农历信息，当前时间指示线 |
| 日程详情 | 展示日程全部信息，提供编辑删除入口 |
| 日程编辑 | 创建/编辑日程，设置时间、地点、提醒等 |
| 设置页面 | ICS导入导出、订阅管理、批量删除 |

-----

## 7\. 版本历史

| 版本 | 日期 | 更新内容 |
|------|------|----------|
| V1.0 | 2025-12-16 | 初始文档 |
| V1.1 | 2025-12-16 | 添加批量删除功能需求 |
| V2.0 | 2025-12-16 | 全面更新，补充实现细节，更新技术栈为 Jetpack Compose |