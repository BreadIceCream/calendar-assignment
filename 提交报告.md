# 智能日历应用 - 项目提交报告

**项目名称：** 智能日历应用 (Smart Calendar App) 
**课程名称：** 大前端菁英班

---

## 一、产品功能介绍

### 1.1 产品概述

智能日历应用是一款基于 Android 原生技术栈开发的功能完备的日历应用，采用现代化的 Jetpack Compose 声明式 UI 框架构建。应用支持多视图切换、完整的日程管理、智能提醒以及农历显示等功能，同时兼容 RFC5545 标准的 ICS 文件导入导出和网络日历订阅。

### 1.2 核心功能

| 功能模块 | 功能描述 |
|----------|----------|
| **多视图展示** | 月视图、周视图、日视图三种维度，满足不同场景需求 |
| **日程管理** | 支持日程的创建、查看、编辑、删除，批量删除 |
| **农历支持** | 完整农历算法，显示农历日期、节气、传统节日 |
| **智能提醒** | 多种提醒选项，支持开机恢复提醒 |
| **ICS导入导出** | 符合 RFC5545 标准，支持与其他日历应用互通 |
| **网络订阅** | 支持订阅在线日历（如节假日日历） |

### 1.3 功能亮点

#### 🗓️ 月视图
- 7xN 网格布局，动态计算行数
- 同时显示公历日期和农历信息
- 有日程的日期显示灰色圆点标记
- 支持左右滑动切换月份
- 点击日期显示当日日程列表

#### 📅 周视图
- 横向展示一周七天，纵向展示24小时时间轴
- 日程以色块形式渲染，直观展示时间占用
- 全天日程在顶部单独区域显示
- 当天显示红色当前时间线

#### 📆 日视图
- 完整展示选中日期的时间轴
- 显示完整农历信息（干支纪年、生肖）
- 红色指示线标识当前时间
- 全天日程和时间段日程分区显示

#### 🌙 农历系统
- 自主实现的农历算法，精确计算
- 支持干支纪年、生肖、农历月日
- 二十四节气精确计算
- 传统节日智能识别

---

## 二、程序概要设计

### 2.1 技术选型

| 技术领域 | 选型方案 |
|----------|----------|
| 开发语言 | Kotlin |
| UI 框架 | Jetpack Compose |
| 架构模式 | MVVM (Model-View-ViewModel) |
| 数据持久化 | Room Database |
| 状态管理 | ViewModel + StateFlow |
| 导航框架 | Navigation Compose |
| 网络请求 | OkHttp |
| 日程提醒 | AlarmManager |

### 2.2 界面流程

```
┌─────────────────────────────────────────────────────────────┐
│                        MainActivity                          │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │                    CalendarScreen                       │ │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐    │ │
│  │  │ 月视图    │ │ 周视图    │ │ 日视图    │ │ 设置      │    │ │
│  │  │MonthView │ │ WeekView │ │ DayView  │ │Settings  │    │ │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘    │ │
│  └─────────────────────────────────────────────────────────┘ │
│                              ↓                               │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │    EventDetailScreen ←→ EventEditScreen                 │ │
│  └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 2.3 数据流设计

```
用户操作 → ViewModel → Repository → DAO → Room Database
                ↓
            StateFlow
                ↓
          UI 自动更新 (Compose Recomposition)
```

---

## 三、软件架构图

### 3.1 整体架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        Presentation Layer                       │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CalendarScreen│ │EventEditScreen│ │SettingsScreen│           │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
│          ↑               ↑               ↑                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │CalendarVM   │  │EventDetailVM│  │SettingsVM   │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
├─────────────────────────────────────────────────────────────────┤
│                         Domain Layer                            │
│  ┌─────────────────────────┐  ┌─────────────────────────┐       │
│  │   CalendarRepository    │  │  SubscriptionRepository │       │
│  └─────────────────────────┘  └─────────────────────────┘       │
├─────────────────────────────────────────────────────────────────┤
│                          Data Layer                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐      │
│  │CalendarEvent│  │ Subscription│  │    AppDatabase      │      │
│  │   Entity    │  │   Entity    │  │   (Room SQLite)     │      │
│  └─────────────┘  └─────────────┘  └─────────────────────┘      │
├─────────────────────────────────────────────────────────────────┤
│                       Utility Layer                             │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐           │
│  │  DateUtils   │  │LunarCalendar │  │   IcsUtils   │           │
│  └──────────────┘  └──────────────┘  └──────────────┘           │
├─────────────────────────────────────────────────────────────────┤
│                       System Services                           │
│  ┌──────────────────┐  ┌────────────────┐ ┌──────────────┐      │
│  │NotificationHelper│  │ReminderReceiver│ │BootReceiver  │      │
│  └──────────────────┘  └────────────────┘ └──────────────┘      │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 模块职责

| 模块 | 职责描述 |
|------|----------|
| **UI Layer** | Compose 组件，负责界面渲染和用户交互 |
| **ViewModel** | 管理 UI 状态，处理业务逻辑，暴露 StateFlow |
| **Repository** | 数据仓库，封装数据源访问，统一数据操作接口 |
| **DAO** | Room 数据访问对象，定义数据库操作方法 |
| **Entity** | 数据实体类，映射数据库表结构 |
| **Utils** | 工具类，提供日期计算、农历算法、ICS解析等 |
| **Notification** | 处理日程提醒的调度和推送 |

---

## 四、技术亮点及实现原理

### 4.1 Jetpack Compose 声明式 UI

**技术亮点：** 采用最新的 Jetpack Compose 框架替代传统 XML 布局，实现声明式 UI 开发。

**实现原理：**
- 使用 `@Composable` 函数描述 UI 组件
- 通过 `State` 和 `StateFlow` 实现响应式数据绑定
- UI 自动根据状态变化重组（Recomposition）

```kotlin
@Composable
fun MonthView(
    year: Int,
    month: Int,
    events: List<CalendarEvent>,  // 状态变化自动触发重组
    onDateSelected: (Int, Int, Int) -> Unit
) {
    // 声明式描述 UI，无需手动更新视图
}
```

### 4.2 自主实现的农历算法

**技术亮点：** 完全自主实现的农历计算系统，无需依赖第三方库。

**实现原理：**
- 基于农历历法数据表（1900-2100年）
- 计算公历与农历的转换
- 二十四节气采用天文算法精确计算
- 传统节日根据农历日期智能匹配

```kotlin
object LunarCalendarUtil {
    // 农历数据表：每年的农历信息编码
    private val LUNAR_INFO = longArrayOf(...)
    
    // 公历转农历核心算法
    fun solarToLunar(year: Int, month: Int, day: Int): LunarDate {
        // 计算距离1900年1月31日的天数偏移
        // 遍历农历年份数据确定农历年月日
    }
    
    // 节气计算：基于太阳黄经度
    fun getSolarTerm(year: Int, month: Int, day: Int): String? {
        // 使用天文算法计算太阳黄经
    }
}
```

### 4.3 RFC5545 标准 ICS 解析与生成

**技术亮点：** 完整支持 iCalendar (RFC5545) 标准，实现与主流日历应用的数据互通。

**实现原理：**
- 解析 VCALENDAR/VEVENT 结构
- 处理时区转换和全天事件
- 支持 DTSTART、DTEND、SUMMARY、DESCRIPTION、LOCATION 等属性

```kotlin
object IcsUtils {
    fun parseFromIcs(content: String): List<CalendarEvent> {
        // 解析 VEVENT 块
        // 处理日期格式（带时区/全天）
        // 转换为本地 CalendarEvent 对象
    }
    
    fun exportToIcs(events: List<CalendarEvent>): String {
        // 生成符合 RFC5545 标准的 ICS 内容
    }
}
```

### 4.4 响应式数据流架构

**技术亮点：** 使用 Kotlin Flow 实现数据库变化的实时监听和 UI 自动更新。

**实现原理：**
```kotlin
// DAO 返回 Flow
@Query("SELECT * FROM calendar_events WHERE ...")
fun getEventsInRange(start: Long, end: Long): Flow<List<CalendarEvent>>

// ViewModel 收集并转换为 StateFlow
private val _monthEvents = MutableStateFlow<List<CalendarEvent>>(emptyList())

fun loadMonthEvents() {
    viewModelScope.launch {
        repository.getEventsInRange(start, end).collect { events ->
            _monthEvents.value = events  // 自动通知 UI 更新
        }
    }
}
```

### 4.5 智能提醒系统

**技术亮点：** 支持多种提醒时间，并能在设备重启后自动恢复提醒。

**实现原理：**
- 使用 `AlarmManager.setExactAndAllowWhileIdle()` 精确定时
- `BootReceiver` 监听 `BOOT_COMPLETED` 广播
- 设备重启后重新注册所有未来提醒

---

## 五、项目结构

```
calendar/
├── app/
│   ├── src/main/
│   │   ├── java/com/example/calendar/
│   │   │   ├── CalendarApplication.kt
│   │   │   ├── MainActivity.kt
│   │   │   ├── data/           # 数据层
│   │   │   │   ├── entity/     # 实体类
│   │   │   │   ├── dao/        # 数据访问对象
│   │   │   │   ├── database/   # 数据库配置
│   │   │   │   └── repository/ # 数据仓库
│   │   │   ├── ui/             # UI层
│   │   │   │   ├── calendar/   # 日历视图
│   │   │   │   ├── event/      # 日程页面
│   │   │   │   ├── settings/   # 设置页面
│   │   │   │   ├── navigation/ # 导航
│   │   │   │   └── theme/      # 主题
│   │   │   ├── viewmodel/      # ViewModel层
│   │   │   ├── notification/   # 通知系统
│   │   │   ├── sync/           # 同步服务
│   │   │   └── util/           # 工具类
│   │   ├── res/                # 资源文件
│   │   └── AndroidManifest.xml
│   └── build.gradle.kts
├── 需求文档.md
├── 提交报告.md
└── test_events.ics              # 测试用 ICS 文件
```

---

## 六、运行环境

| 环境要求 | 版本 |
|----------|------|
| Android Studio | Ladybug 或更高版本 |
| Kotlin | 2.0.21 |
| Gradle | 8.x |
| 最低 Android 版本 | Android 8.0 (API 26) |
| 目标 Android 版本 | Android 15 (API 35) |

---

## 七、使用说明

### 7.1 日历浏览
1. 打开应用默认显示月视图
2. 左右滑动可切换月份
3. 点击顶部按钮可切换月/周/日视图
4. 点击日期可查看当日日程

### 7.2 创建日程
1. 点击右下角 "+" 悬浮按钮
2. 填写日程标题（必填）
3. 设置开始和结束时间
4. 可选填地点、备注、提醒时间
5. 点击保存

### 7.3 导入外部日程
1. 进入设置页面
2. 点击"导入 ICS 文件"
3. 选择 .ics 格式的日历文件
4. 导入完成后日程自动显示

### 7.4 订阅网络日历
1. 进入设置页面
2. 点击 "+" 添加订阅
3. 输入订阅名称和 URL
4. 系统自动同步订阅内容

---

## 八、源代码仓库

**仓库地址：** https://github.com/BreadIceCream/calendar-assignment

## 九、演示视频

**视频文件：** demo_video.mp4

---